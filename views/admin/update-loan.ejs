<%- include('../includes/admin-header.ejs') %>
<style>
    body{
        /* background-image: url('/images/backgroundImg.jpg'); */
        background-color:rgb(12, 23, 51) ;
    }
    h1,h4{
        text-align: center;
    }
    main{
        display: flexbox;
        background-image: url('/images/backgroundImg.jpg');
        background-position: center;
        color: white;
        /* height: 600px; */
        display: flexbox;
        max-width: 100%;
        object-fit: cover;

    }
    .input-box{
        /* margin: 20px 10px 20px 10px; */
        margin: auto;
        width: 80%;
        padding-bottom: 5px;
     display: flex;
     flex-direction: column;
     justify-content: center;
    }
    form{
        margin: auto;
        width:40%;
        border: 2px solid white;
        color: white;
        background-color: rgb(12, 23, 51);
        border-radius: 30px;
        box-shadow: inset;
        opacity: 50%;
        display: flexbox;
        padding: 5px;
        /* height: 80%; */
    }

.Email{
    width: 100%;
    border: none;
    border-radius: 9px;
    height: 40px;
    background-color: rgb(2, 6, 16);
    color: white;
}
.Password{
    width: 100%;
    border: none;
    border-radius: 9px;
    height: 40px;
    background-color: rgb(2, 6, 16);
    color: white;
}
label{
    color: white;
    text-align: left;
    font-size: 20px;
    /* margin-bottom: 50px; */
}
.Email:hover{
    border-bottom: 2px solid white;
    box-shadow: 3px, 3px, 4px, white;
   
}
.Password:hover{
    border-bottom: 2px solid white;
    box-shadow: 3px, 9px, 14px, white;
}
.btns{
    width: 70%;
    height: 30px;
    border-radius: 10px;
    font-size: medium;
    font-weight: 500px;
}
.btns:hover{
    background-color: rgb(12, 23, 51);
    color: rgb(207, 15, 15);
}
@media only screen and(max-width:768px){
    form{
        margin: auto;
        width:100%;
       
        /* height: 80%; */
    }
    main{
        height: fit-content;
        /* height: 100%; */
    }
}
</style>

<body>
    <%- include('../includes/admin-navbar.ejs') %>
    <main>
        <div id="error"><%= JSON.stringify(error)%></div>
        <div id="success"></div>
        <form id="form" class="text-danger" enctype="multipart/form-data">
            <h4>Admin:Add Loans</h4>
            <input type="hidden" value="<%= Loan.id %>" name="id">
            <div class="input-box">
                <label for="Type">Type</label><br>
                <input type="text" name="Type" id="Type" value="<%= Loan.loanType %>" class="Email" placeholder="Enter name...">
            </div>

            <div class="input-box">
                <label for="Email">Duration</label><br>
                <input type="text" name="Duration" id="Duration" value="<%= Loan.duration %>" class="Email" placeholder="Enter email">
            </div>
            
            <div class="input-box">
                <label for="Amount">Amount</label><br>
                <input type="number" name="Amount" id="Amount" value="<%= Loan.amount %>" class="Email" placeholder="Enter Amount number">
            </div>

    <div class="input-box">
        <button type="submit" class="btns btn-light" id="submit">Update Loan</button>
    </div>
          
        </form>
    </main>    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        let form=document.getElementById('form')
        form.addEventListener('submit',send)
        let loadStatus=document.getElementById('submit')
        function send(e){
            e.preventDefault();
            loadStatus.value="Loading..."
    
            let Type=document.getElementById('Type').value;
            let Duration=document.getElementById('Duration').value;
            let Amount=document.getElementById('Amount').value;
    
            let formData = new FormData()
            formData.append('id', id)
            formData.append('Type', Type)
            formData.append('Duration', Duration)
            formData.append('Amount', Amount)
   
            axios.put('/admin-update-loan', formData)
            
                .then(response => {
                    console.log(response)
                    loadStatus.value="Submit";
                    if(response.data.success){
                        document.getElementById('success').innerHTML = `
                        <div class="alert alert-success alert-dismissible">
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            <strong>Success!</strong> Product submitted successfully 
                        </div>`;
                        setTimeout(() => {
                            window.location='/admin-dashboard';
                        }, 3000);
                    }
                })
                .catch(error => {
                    console.log(error);
                    loadStatus.value="Submit";
                    document.getElementById('error').innerHTML = `
                    <div class="alert alert-danger alert-dismissible">
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        <strong>Oops!</strong> An error occurred while submitting the product.
                    </div>`;
                });
        }
    </script>
    
    <%- include('../includes/admin-footer.ejs') %>
</body>
</html>